---
name: gov/vpt/ataskaitos
title: "Viešųjų pirkimų ataskaitos"
type: dataset
version: 1
date: "2019-06-25"
owner: gov/vpt
resources:
  ATN1:
    type: sql
    objects:
      valstybe/pirkimas:
        source: ATN1
        properties:
          id:
            type: pk
            source: TENDER_ID
            # TODO: CVPIS_APPENDIX.EXTERNAL_REF -> PLANNED_PROCUREMENT.EXTERNAL_REFERENCE_NUMBER
            # Open-Contracting uses RelatedProcess model.
          pavadinimas:
            type: string
            source: TITLE
          # FIXME: dates (periods)
          # - PUBLISHED_DATE
          pirkimas:
            # FIXME: Reiksme turi buti none jei TENDER_ID ir
            #        PROCUREMENT_NUMBER yra vienodi
            type: ref
            object: valstybe/pirkimas
            source: PROCUREMENT_NUMBER
          pirkimo_tipas:
            # FIXME: Reiksme turi buti none jei TENDER_ID ir PROCUREMENT_NUMBER yra vienodi
            type: string
            const: vykdomasis
            enum: 
              - vykdomasis
              - ataskaita
          konkurso_tipas:
            type: string
            source: DESIGN_CONTEST_VALUE
            enum:
              - tarptautinis
              - supaprastintas
      valstybe/pirkimas/ataskaita:
        source: ATN1$H
        properties:
          id:
            type: pk
            source: TENDER_ID
          pirkimas:
            type: ref
            object: valstybe/pirkimas
            source: TENDER_ID
          EPS_REF_NR:
            type: string
            source: EPS_REF_NR
      organizacija:
        source: ATN1
        properties:
          id:
            type: pk
            source: AUTHORITY_ORG_NR
          pirkimas:
            type: ref
            object: valstybe/pirkimas
            source: TENDER_ID
          adresas: 
            type: spatial
            source: POSTAL_ADDRESS_1
      valstybe/pirkimas/dalyvis:
        source: ATN1
        properties:
          id:
            type: pk
            source: 
              - TENDER_ID
              - LEGAL_ENTITY_CODE_1
          organizacija:
            type: ref
            object: organizacija
            source: LEGAL_ENTITY_CODE_1
          tipas:
            type: string
            const: perkancioji
            enum:
              - vykdomoji
              - perkancioji

  # Įstaiga gali vykdyti pirkimą pati arba įgalioti pirkimo vykdymą kitai
  # įstaigai. Čia `ATN1/perkancioji` dalyje nurodyta kas perka, t.y. kas užsakė
  # pirkimą.
  ATN1/perkancioji:
    type: sql
    objects:
      valstybe/pirkimas/dalyvis:
        source: ATN1
        properties:
          id:
            type: pk
            source: 
              - TENDER_ID
              - LEGAL_ENTITY_CODE_1
          organizacija:
            type: ref
            object: organizacija
            source: LEGAL_ENTITY_CODE_1
          tipas:
            type: string
            const: perkancioji
            enum:
              - vykdancioji
              - perkancioji
          cvpis_nuoroda:
            type: string
            source: URL_BUYER_1
          ar_suteikti_igaliojimai_kitai_perkanciai_organizacijai:
            type: boolean
            source: IS_PROCUREMENT_POWER_GRANTED_TO_ANOTHER_AUTHORITY
      organizacija:
        source: ATN1
        properties:
          id:
            type: pk
            source: LEGAL_ENTITY_CODE_1
          registracijos_numeris:
            type: string
            source: LEGAL_ENTITY_CODE_1
          pavadinimas:
            type: string
            source: OFFICIAL_NAME_1
          adresas: 
            # TODO: prie adreso yra ne tik POSTAL_ADDRESS_1, bet ir TOWN_1, POSTAL_CODE_1, COUNTRY_1
            # TODO: transformuoti adresą į koordinates
            type: string
            source: POSTAL_ADDRESS_1
          interneto_svetaine:
            type: string
            source: URL_GENERAL_1
      organizacija/narys:
        source: ATN1
        properties:
          id:
            type: pk
            source:
              - LEGAL_ENTITY_CODE_1  # Įmonės kodas, kurioje dirba asmuo.
              - CONTACT_POINT_1      # Asmens vardas ir pavardė.
          asmuo:
            type: ref
            object: asmuo
            source: 
              - LEGAL_ENTITY_CODE_1  # Įmonės kodas, kurioje dirba asmuo.
              - CONTACT_POINT_1      # Asmens vardas ir pavardė.
          organizacija:
            type: ref
            object: organizacija
            source: LEGAL_ENTITY_CODE_1
      asmuo/kontaktas:
        source: ATN1
        properties:
          id: 
            type: pk
            source: 
              - LEGAL_ENTITY_CODE_1  # Įmonės kodas, kurioje dirba asmuo.
              - CONTACT_POINT_1      # Asmens vardas ir pavardė.
              # FIXME: how to include `const: email` here? This does not come
              #        from source, it is defined in this YAML file.
              # - {const: email}
              - EMAIL_ADDRESS_1      # El. pašto adresas.
          tipas:
            type: string
            const: email
          reiksme: 
            type: string
            source: EMAIL_ADDRESS_1      
          asmuo:
            type: ref
            object: asmuo
            source: 
              - LEGAL_ENTITY_CODE_1
              - CONTACT_POINT_1 
      asmuo:
        source: ATN1
        properties:
          id: 
            type: pk
            source: 
              - LEGAL_ENTITY_CODE_1  # Įmonės kodas, kurioje dirba asmuo.
              - CONTACT_POINT_1      # Asmens vardas ir pavardė.
          pavadinimas:
            # Asmens vardas, pavardė.
            type: string
            source: CONTACT_POINT_1

  # Įstaiga, kuri nėra pirkimo užsakovas, bet vykdo pirkimą, už kurią nors kitą
  # įstaigą.
  #ATN1/vykdancioji:
    # TODO:
